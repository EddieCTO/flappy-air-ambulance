<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flappy Air Ambulance</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden; background: #70c5ce;
    font-family: Arial, sans-serif;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  #gameContainer {
    position: relative;
    width: 100vw; height: 100vh;
    display: flex; justify-content: center; align-items: center;
    background: linear-gradient(to bottom, #70c5ce 0%, #fff 100%);
  }
  canvas {
    background: #70c5ce;
    border: 2px solid #007acc;
    border-radius: 10px;
    max-width: 100%;
    height: auto;
    display: block;
  }
  #startBtn {
    position: absolute;
    top: 20px; left: 50%;
    transform: translateX(-50%);
    padding: 12px 28px;
    font-size: 18px;
    font-weight: bold;
    background: #007acc;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }
  #startBtn:active {
    background: #005f99;
  }
  #score {
    position: absolute;
    top: 70px; left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 4px #0007;
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="gameCanvas" width="480" height="640"></canvas>
  <button id="startBtn">Start Game</button>
  <div id="score" style="display:none;">0</div>
</div>

<script>
// Base64 flipped helicopter PNG (small 64x64 px)
// This is a flipped version pointing right
const helicopterBase64 = 
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAEXUlEQVR4nO2bX0wUURDH7+zTxo" +
"0QpjGJjP6GpFkIUQUMaGJhGlRuKKUCGImQH8DBIQkcCgkEQx8QCg4RCEaAwgIaCn6v3Xt3TnPvnt/t6+0lvz9efjR7v5+bmTlzZs5c" +
"tXJly5cuWLFi1qxYsWLFi1bxuG7r4f7f46OdPjx44dO3bs2LFy5cqV69erVq1qxYsWLFi1YsWLFi1asXLFj5uX9u7QupSwzlkK+Nc" +
"pAIlqFG9pgflJ7wGZ6wMxJ4ASWKK1dcCUQv9Aq/jlEAz/YYzTNGf5sAo7VSD7X0EG1ULUWBReGhht1wBKZ5qAC2H2G7fo8tk8jVDE" +
"p+OCQwvQR6WgKmFgXmIQKl3MBGUk0uHtrIGS6EXHGS43BW0MuX3QmE42KZ9ABLVHTNiMZYkArz8RGvjvRF4jO81LVGGsRF72HRNEy" +
"cDKEq4hxFvpFKFO13QYqxYWrMLYYg4NZHHEbqQhRIHEIbmhRBzGGa6FaQIZyr4DH9uXyMeUQlyK8BgXqB2W8h+jRx+BL3HkED+Qps" +
"TEGpGKFpCOfV2eXYcuHsE6o06R5oqgPyNfXqVQKq2QFBLxG1VfoKsEXWku9gSeAauoRKYUVV+ghsdR8wPyi5X1cgr2AxihN8T1UAj" +
"uQew6y4U7iHXrMwMGxF4I3iNYSpEAH5IVcQHMQExkP0sKMgb4i+cBJ4ARxxi96gDdr0C9jOM8I5VxClGJA7FY88BjiH+1hvSlTTOE" +
"XUE5gmEFz6C30jhH0iEGEfwHKZTt+7TiAHXQAAAABJRU5ErkJggg==";

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const scoreEl = document.getElementById('score');

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

let helicopterImg = new Image();
helicopterImg.src = helicopterBase64;

let frames = 0;
let pipes = [];
let score = 0;
let gameState = 'start'; // 'start', 'playing', 'gameover'
let animationId;

const GRAVITY = 0.4;
const LIFT = -7;
const PIPE_WIDTH = 60;
const PIPE_GAP = 150;
const PIPE_SPEED = 2;

class Helicopter {
  constructor() {
    this.x = 80;
    this.y = HEIGHT / 2;
    this.width = 64;
    this.height = 64;
    this.velocity = 0;
  }
  update() {
    this.velocity += GRAVITY;
    this.y += this.velocity;

    // Floor and ceiling collision
    if (this.y + this.height > HEIGHT) {
      this.y = HEIGHT - this.height;
      this.velocity = 0;
      gameOver();
    }
    if (this.y < 0) {
      this.y = 0;
      this.velocity = 0;
    }
  }
  draw() {
    ctx.drawImage(helicopterImg, this.x, this.y, this.width, this.height);
  }
  flap() {
    this.velocity = LIFT;
    playSound(flapSound);
  }
}

class Pipe {
  constructor() {
    this.x = WIDTH;
    this.top = Math.floor(Math.random() * (HEIGHT - PIPE_GAP - 100)) + 50;
    this.bottom = this.top + PIPE_GAP;
    this.width = PIPE_WIDTH;
  }
  update() {
    this.x -= PIPE_SPEED;
  }
  draw() {
    ctx.fillStyle = '#228B22'; // dark green pipe
    // Top pipe
    ctx.fillRect(this.x, 0, this.width, this.top);
    // Bottom pipe
    ctx.fillRect(this.x, this.bottom, this.width, HEIGHT - this.bottom);
  }
  hits(heli) {
    if (
      heli.x + heli.width > this.x &&
      heli.x < this.x + this.width &&
      (heli.y < this.top || heli.y + heli.height > this.bottom)
    ) {
      return true;
    }
    return false;
  }
}

// Sound effects
const flapSound = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQQAAA=='); // tiny silent placeholder
const crashSound = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQQAAA=='); // silent placeholder

// To load real sounds, replace above with actual base64 sound data or URLs

let helicopter;
function resetGame() {
  helicopter = new Helicopter();
  pipes = [];
  score = 0;
  frames = 0;
  gameState = 'start';
  scoreEl.style.display = 'none';
  startBtn.textContent = 'Start Game';
}

function gameOver() {
  gameState = 'gameover';
  startBtn.style.display = 'block';
  startBtn.textContent = 'Restart Game';
  playSound(crashSound);
}

function playSound(sound) {
  // Simple check to allow playing multiple times
  if (!sound) return;
  sound.currentTime = 0;
  sound.play().catch(() => {});
}

function gameLoop() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  // Draw background gradient
  let grad = ctx.createLinearGradient(0, 0, 0, HEIGHT);
  grad.addColorStop(0, '#70c5ce');
  grad.addColorStop(1, '#fff');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  helicopter.update();
  helicopter.draw();

  // Pipes management
  if (gameState === 'playing') {
    if (frames % 90 === 0) {
      pipes.push(new Pipe());
    }

    for (let i = pipes.length - 1; i >= 0; i--) {
      pipes[i].update();
      pipes[i].draw();

      if (pipes[i].hits(helicopter)) {
        gameOver();
      }

      // Increase score when pipe goes off screen
      if (pipes[i].x + pipes[i].width < helicopter.x && !pipes[i].scored) {
        score++;
        pipes[i].scored = true;
        scoreEl.textContent = score;
      }

      // Remove off-screen pipes
      if (pipes[i].x + pipes[i].width < 0) {
        pipes.splice(i, 1);
      }
    }
  }

  frames++;
  animationId = requestAnimationFrame(gameLoop);
}

// Input handlers
function flap() {
  if (gameState === 'start') {
    gameState = 'playing';
    scoreEl.style.display = 'block';
    startBtn.style.display = 'none';
  }
  if (gameState === 'playing') {
    helicopter.flap();
  }
}

startBtn.addEventListener('click', () => {
  resetGame();
  flap();
});

window.addEventListener('keydown', (e) => {
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    e.preventDefault();
    flap();
  }
});

window.addEventListener('touchstart', (e) => {
  e.preventDefault();
  flap();
}, {passive:false});

// Start with reset game but donâ€™t start loop until image loads
resetGame();
helicopterImg.onload = () => {
  gameLoop();
};
</script>
</body>
</html>
