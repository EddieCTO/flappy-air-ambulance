<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Fly The Air Ambulance</title>
<style>
  body {
    margin: 0;
    background: #87ceeb; /* sky blue */
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
    user-select: none;
  }
  canvas {
    background: linear-gradient(to bottom, #87ceeb 0%, #fff 100%);
    display: block;
    margin-top: 10px;
    border: 2px solid #333;
  }
  #startBtn {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 18px;
    cursor: pointer;
  }
  #speedControl {
    margin-top: 10px;
    width: 300px;
  }
  #loading {
    font-size: 24px;
    margin-top: 40px;
  }
</style>
</head>
<body>

<div id="loading">Loading assets, please wait...</div>
<canvas id="gameCanvas" width="400" height="600" style="display:none;"></canvas>
<button id="startBtn" style="display:none;">Start Game</button>
<audio id="flapSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="hitSound" src="https://actions.google.com/sounds/v1/impacts/crash.ogg" preload="auto"></audio>


<label id="speedLabel" for="speedControl" style="display:none; margin-top:10px;">
  Game Speed: <span id="speedValue">1.0</span>x
</label>
<input id="speedControl" type="range" min="0.3" max="2.0" step="0.05" value="1" style="display:none;" />

<script>
// Constants
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const loadingDiv = document.getElementById('loading');
const speedControl = document.getElementById('speedControl');
const speedValue = document.getElementById('speedValue');
const speedLabel = document.getElementById('speedLabel');

const GRAVITY = 0.3;   // slower fall
const LIFT = -5;       // gentler rise
const OBSTACLE_WIDTH = 120;
const OBSTACLE_GAP = 150;
const OBSTACLE_DISTANCE = 300;

let helicopter = {
  x: 80,
  y: 400,
  width: 60,
  height: 40,
  velocity: 0
};

const skyscraperImg = new Image();
skyscraperImg.src = "https://eddiecto.github.io/flappy-air-ambulance/skyscraper.png"; // or base64 string

const cloudImg = new Image();
cloudImg.src = "https://eddiecto.github.io/flappy-air-ambulance/cloud.png"; // or base64 string

let obstacles = [];
let frameCount = 0;
let gameSpeed = 1.0;
let score = 0;
let isPlaying = false;
let helicopterImg = new Image();

let isTouchActive = false; // For mobile hold

// Load helicopter image
helicopterImg.src ="https://eddiecto.github.io/flappy-air-ambulance/helicopter.png"; // Realistic helicopter flipped facing right
helicopterImg.onload = () => {
  loadingDiv.style.display = 'none';
  canvas.style.display = 'block';
  startBtn.style.display = 'inline-block';
  speedControl.style.display = 'block';
  speedLabel.style.display = 'block';
  drawStartScreen();
};
helicopterImg.onerror = () => {
  loadingDiv.textContent = "Failed to load helicopter image.";
};

// Reset game variables
function resetGame() {
  helicopter.y = canvas.height / 2 - 40;
  helicopter.velocity = 0;
  obstacles = [];
  frameCount = 0;
  score = 0;
  isPlaying = true;
}

// Create obstacles with random gap heights
function createObstacle() {
  let topHeight = Math.floor(Math.random() * (canvas.height - OBSTACLE_GAP - 100)) + 50;
  obstacles.push({
    x: canvas.width,
    top: topHeight,
    bottom: canvas.height - topHeight - OBSTACLE_GAP,
    passed: false
  });
}

// Draw helicopter
function drawHelicopter() {
  ctx.drawImage(helicopterImg, helicopter.x, helicopter.y, helicopter.width, helicopter.height);
}

// Draw obstacles
function drawObstacles() {
ctx.globalAlpha = 0.9; // slightly transparent
  obstacles.forEach(obs => {
     // Top pipe
     ctx.drawImage(cloudImg, obs.x, 0, OBSTACLE_WIDTH, obs.top);
    // Bottom pipe
    ctx.drawImage(skyscraperImg, obs.x, canvas.height - obs.bottom, OBSTACLE_WIDTH, obs.bottom);
  });
ctx.globalAlpha = 1.0; // reset alpha
}

// Draw score
function drawScore() {
  ctx.fillStyle = '#000';
  ctx.font = '28px Arial';
  ctx.fillText(`Score: ${score}`, 10, 40);
}

// Draw game over screen
function drawGameOver() {
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#fff';
  ctx.font = '48px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2 - 40);
  ctx.font = '24px Arial';
  ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2);
  ctx.fillText('Click "Start Game" to try again', canvas.width / 2, canvas.height / 2 + 40);
  ctx.textAlign = 'start';
}

// Draw start screen
function drawStartScreen() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#87ceeb';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#000';
  ctx.font = '36px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('Fly The Air Ambulance', canvas.width / 2, canvas.height / 2 - 40);
  ctx.font = '20px Arial';
  ctx.fillText('Press Space or Tap to Fly', canvas.width / 2, canvas.height / 2);
  ctx.fillText('Avoid the Clouds And Skyscrapers!', canvas.width / 2, canvas.height / 2 + 30);
  ctx.textAlign = 'start';
  drawHelicopter();
}

// Check collision with obstacles or ground/ceiling
function checkCollision() {
  if (helicopter.y < 0 || helicopter.y + helicopter.height > canvas.height) {
    hitSound.play();
    return true;
  }
  for (let obs of obstacles) {
    if (
      helicopter.x + helicopter.width > obs.x &&
      helicopter.x < obs.x + OBSTACLE_WIDTH
    ) {
      if (helicopter.y < obs.top || helicopter.y + helicopter.height > canvas.height - obs.bottom) {
        hitSound.play();
        return true;
      }
    }
  }
  return false;
}

function gameLoop() {
  if (!isPlaying) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Update helicopter velocity & position
  helicopter.velocity += GRAVITY * gameSpeed;
  helicopter.y += helicopter.velocity;

  // Move obstacles
  obstacles.forEach(obs => obs.x -= 3 * gameSpeed);

  // Remove off-screen obstacles
  if (obstacles.length && obstacles[0].x + OBSTACLE_WIDTH < 0) {
    obstacles.shift();
  }

  // Add new obstacles at fixed intervals
  frameCount++;
  if (frameCount > OBSTACLE_DISTANCE / (3 * gameSpeed)) {
    createObstacle();
    frameCount = 0;
  }

  // Check if passed obstacle for score
  obstacles.forEach(obs => {
    if (!obs.passed && obs.x + OBSTACLE_WIDTH < helicopter.x) {
      score++;
      obs.passed = true;
    }
  });

  drawObstacles();
  drawHelicopter();
  drawScore();

  if (checkCollision()) {
    isPlaying = false;
    drawGameOver();
    startBtn.style.display = 'inline-block';
  } else {
    requestAnimationFrame(gameLoop);
  }
}

// Event handlers for controls

function flyUp() {
  helicopter.velocity = LIFT;
  flapSound.play();
}

// Keyboard support
window.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') {
    e.preventDefault();
    if (isPlaying) {
      flyUp();
    }
  }
});

// Mobile touch support
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  if (isPlaying) {
    isTouchActive = true;
    flyUp();
  }
});
canvas.addEventListener('touchend', e => {
  e.preventDefault();
  isTouchActive = false;
});

// Also allow holding touch to keep flying up gradually
function touchFlyLoop() {
  if (isPlaying && isTouchActive) {
    flyUp();
  }
  requestAnimationFrame(touchFlyLoop);
}

// Start game button
startBtn.addEventListener('click', () => {
  resetGame();
  startBtn.style.display = 'none';
  gameLoop();
});

// Speed control slider
speedControl.addEventListener('input', () => {
  gameSpeed = parseFloat(speedControl.value);
  speedValue.textContent = gameSpeed.toFixed(2);
});

// Initial call for touch fly loop
touchFlyLoop();
</script>

</body>
</html>
